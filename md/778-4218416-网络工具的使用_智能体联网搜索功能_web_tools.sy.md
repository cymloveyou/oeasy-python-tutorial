---
show: step
version: 1.0
enable_checker: true
---

# æ–‡ç”Ÿå›¾æ¨¡å‹è°ƒç”¨

## å›å¿†

- ä¸Šæ¬¡æˆ‘ä»¬è®©æ™ºèƒ½ä½“ä½¿ç”¨èµ·ç»ˆç«¯å·¥å…·

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4218410/uid1190679-20250918-1758161821194) 

- å¦‚ä½•è®©æ™ºèƒ½ä½“ 
	- ä½¿ç”¨ ç½‘ç»œæœç´¢å·¥å…·å‘¢ï¼Ÿ 

### åˆå§‹åŒ–æ™ºèƒ½ä½“

|è§’è‰²|	æ ¸å¿ƒå®šä½	|ä½œç”¨ä¸ç‰¹ç‚¹|	å…¸å‹ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹|	
|---|---|---|---|
|system |	æ¨¡å‹éšå½¢å¼•å¯¼è€…|1. æå‰è®¾å®šæ¨¡å‹è¡Œä¸ºï¼ˆå¦‚â€œç®€æ´å›ç­”â€â€œç”¨ä¸“ä¸šæœ¯è¯­â€ï¼‰ <br/>2. ä¸ç›´æ¥å‚ä¸å¯¹è¯ï¼Œç”¨æˆ·çœ‹ä¸åˆ°<br/>3. å½±å“æ•´ä¸ªå¯¹è¯çš„å›ç­”é£æ ¼å’Œæ–¹å‘	|ä½ æ˜¯è€å¿ƒçš„æ•°å­¦è€å¸ˆ<br/>è§£é¢˜æ­¥éª¤è¦è¯¦ç»†|
|user|	å¯¹è¯éœ€æ±‚å‘èµ·è€…|1. ç›´æ¥ä¼ é€’ç”¨æˆ·çš„æé—®ã€éœ€æ±‚æˆ–æŒ‡ä»¤<br/>2. æ˜¯æ¨¡å‹å›ç­”çš„ç›´æ¥è§¦å‘ç‚¹<br/>3. å†…å®¹ä¼šè¢«æ¨¡å‹ä½œä¸ºæ ¸å¿ƒä¾æ®æ¥ç”Ÿæˆå›åº”<br/>|	â€œè¯·è§£é‡Šä»€ä¹ˆæ˜¯è´¨æ•°ï¼Ÿâ€<br/>â€œå¸®æˆ‘å†™ä¸€æ®µç”Ÿæ—¥ç¥ç¦â€	|
|assistant	|å¯¹è¯çš„â€œå†å²å›åº”è®°å½•è€…â€	|1. å­˜å‚¨æ¨¡å‹æ­¤å‰ç»™å‡ºçš„å›ç­”ï¼Œä½œä¸ºå¯¹è¯ä¸Šä¸‹æ–‡<br/>2. æ— ä¸»åŠ¨ä½œç”¨ï¼Œéœ€æ‰‹åŠ¨ä¼ å…¥å†å²è®°å½•<br/>3. è®©æ¨¡å‹â€œè®°ä½â€ä¹‹å‰çš„å†…å®¹ï¼Œä¿è¯å¤šè½®å¯¹è¯è¿è´¯<br/>| è¿è´¯ä¸Šä¸‹æ–‡ |å¤šè½®èŠå¤©æ—¶åŸºäºä¸Šä¸‹æ–‡å›ç­”|	

```
from openai import OpenAI
import sys

# åˆå§‹åŒ–OpenAIå®¢æˆ·ç«¯
client = OpenAI(
    base_url='https://api-inference.modelscope.cn/v1',
    api_key = 'ms-9b5aef45-a43a-4f6a-bd74-8691b1197519',
)

# åˆå§‹åŒ–æ¶ˆæ¯å†å²ï¼ŒåŒ…å«ç³»ç»Ÿæç¤ºè¯
messages = [
    {
        'role': 'system',
        'content': 'ä½ æ˜¯ä¸€ä¸ªè®°å¿†åŠ›å¾ˆå¼ºçš„åŠ©æ‰‹ï¼Œèƒ½å¤Ÿè®°ä½ä¹‹å‰çš„å¯¹è¯å†…å®¹ï¼Œå¹¶æ ¹æ®ä¸Šä¸‹æ–‡æä¾›è¿è´¯çš„å›ç­”ã€‚'
    }
]

print("æ¬¢è¿ä½¿ç”¨æ™ºèƒ½å¯¹è¯åŠ©æ‰‹ï¼è¾“å…¥'é€€å‡º'æˆ–'q'ç»“æŸå¯¹è¯ã€‚\n")

# å¯¹è¯å¾ªç¯
while True:
    # è·å–ç”¨æˆ·è¾“å…¥
    user_input = input("ä½ : ")
    
    # æ£€æŸ¥æ˜¯å¦é€€å‡º
    if user_input.lower() in ['é€€å‡º', 'q', 'quit', 'exit']:
        print("å†è§ï¼")
        break
    
    # æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°å†å²
    messages.append({
        'role': 'user',
        'content': user_input
    })
    
    try:
        # å‘é€è¯·æ±‚åˆ°æ¨¡å‹
        response = client.chat.completions.create(
            model='Qwen/Qwen3-Next-80B-A3B-Instruct', # ModelScope Model-Id
            messages=messages,
            stream=True
        )
        
        print("åŠ©æ‰‹: ", end='', flush=True)
        assistant_reply = ""
        
        # å¤„ç†æµå¼å“åº”
        for chunk in response:
            if chunk.choices[0].delta.content:
                print(chunk.choices[0].delta.content, end='', flush=True)
                assistant_reply += chunk.choices[0].delta.content
        
        print()  # æ¢è¡Œ
        
        # æ·»åŠ åŠ©æ‰‹å›å¤åˆ°å†å²
        messages.append({
            'role': 'assistant',
            'content': assistant_reply
        })
        
    except Exception as e:
        print(f"å‘ç”Ÿé”™è¯¯: {e}")
        # å‘ç”Ÿé”™è¯¯æ—¶ï¼Œç§»é™¤æœ€åæ·»åŠ çš„ç”¨æˆ·æ¶ˆæ¯
        if messages and messages[-1]['role'] == 'user':
            messages.pop()
```

### ç½‘ç»œè·å–

- ç½‘ç»œè·å–æœ‰ä¸¤ä¸ªæ¸ é“
	1. çˆ¬å–æœç´¢å¼•æ“
	2. ç›´æ¥ä½¿ç”¨api

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4218416/uid1190679-20250919-1758261435401) 

- æˆ‘ä»¬è¯•è¯•apiçš„æ–¹å¼

### ç™¾åº¦apiæ¥å£

- ç™¾åº¦æœç´¢apiæ¥å£å®šä¹‰
	- https://cloud.baidu.com/doc/AppBuilder/s/pmaxd1hvy

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4218416/uid1190679-20250919-1758254720655) 

- ä½¿ç”¨apiæ¥å£éœ€è¦api-key
	- https://console.bce.baidu.com/iam/#/iam/apikey/list
	- åˆ›å»ºå¹¶å¤åˆ¶apikey

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4218416/uid1190679-20250919-1758254354175) 

- å°è¯•ä½¿ç”¨æ¥å£

### å…·ä½“ä»£ç 

```
#!/usr/bin/env python3
import requests, json, sys

def format_search_results(result):
    """æå–å¹¶æ ¼å¼åŒ–æœç´¢ç»“æœ"""
    output = []
    
    # æ˜¾ç¤ºè¯·æ±‚ID
    if 'request_id' in result:
        output.append(f"REQUEST_ID: {result['request_id']}")
        output.append("-" * 50)
    
    # æå–referencesä¸­çš„æœç´¢ç»“æœ
    references = result.get('references', [])
    if references:
        for item in references[:5]:
            title = item.get('title', 'æ— æ ‡é¢˜')
            url = item.get('url', 'æ— é“¾æ¥')
            content = item.get('content', 'æ— æè¿°')
            # æˆªæ–­è¿‡é•¿çš„å†…å®¹
            if len(content) > 200:
                content = content[:200] + '...'
            output.append(f"{title} | {url} | {content}")
    else:
        output.append("æœªæ‰¾åˆ°æœç´¢ç»“æœ")
    
    return "\n".join(output)

query = sys.argv[1] if len(sys.argv) > 1 else "åŒ—äº¬æœ‰å“ªäº›æ—…æ¸¸æ™¯åŒº"
url = "https://qianfan.baidubce.com/v2/ai_search/chat/completions"
headers = {
    "Authorization": "Bearer bce-v3/ALTAK-z6Nrmu8xKq4mpNsp55PPv/037e653ff0ed268dd21dad96e73464614f75f991",
    "Content-Type": "application/json"
}
data = {
    "messages": [{"content": query, "role": "user"}],
    "search_source": "baidu_search_v2",
    "resource_type_filter": [{"type": "web", "top_k": 20}],
    "search_recency_filter": "year"
}

try:
    response = requests.post(url, headers=headers, json=data)
    response.raise_for_status()
    result = response.json()
    
    print(f"QUERY: {query}")
    print(format_search_results(result))
except Exception as e:
    print(f"ERROR: {e}")
```

### è¿è¡Œæ•ˆæœ

```
python3 baidu.py åŒ—äº¬å¤©æ°”
```

- æœç´¢æˆåŠŸ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4218416/uid1190679-20250919-1758263522517) 

- æƒ³è®©agent å…·æœ‰æœç´¢åŠŸèƒ½

### èåˆä»£ç 

```
æ ¹æ®è¿™ä¸¤ä¸ªæ–‡ä»¶
è®©agentå…·å¤‡æœç´¢åŠŸèƒ½
```

### æ€»ç»“

- è¿™
- ä¸‹æ¬¡å†è¯´ğŸ‘‹