---
show: step
version: 1.0
enable_checker: true
---

# è¿½åŠ å†™å…¥

## å›å¿†

- ä¸Šæ¬¡æˆ‘ä»¬æçš„æ˜¯æ–‡ä»¶è¯»å†™çš„é”å®š
- é çš„æ˜¯ fcntl è¿™ä¸ªåŒ…
- å¯ä»¥æœ‰
  - åˆ†äº«é” LOCK_SH
  - ç‹¬äº«é” LOCK_EX
  - é˜»å¡æ ‡å¿— LOCK_NB
  - å–æ¶ˆé” LOCK_UN
- ä¸è¿‡å¾—åˆ°é”äº†ä¹‹å
- ä¹Ÿæ˜¯åœ¨åŸå§‹åŸºç¡€ä¸ŠæŠŠåŸæ¥çš„å†…å®¹æŠ¹æ‰äº†
- æˆ‘æƒ³è¦åŸæ¥çš„éƒ½åœ¨
- æ–°æ¥çš„è¿½åŠ è¿›å»
- å¯ä»¥ä¹ˆï¼Ÿ
- å»å“ªé‡Œæœå‘¢ ğŸ¤”
- é—®ä½ å‘¢ï¼ï¼ï¼

### é—®

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20240918-1726670083519)

- ä½¿ç”¨aæ¨¡å¼

### æœç´¢

- å» open é‚£é‡Œæ‰¾æ‰¾æ€è·¯
- help(open)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210826-1629975180837)

- æ„Ÿè§‰å°±æ˜¯ a

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210826-1629975158377)

- appending æ¨¡å¼

### æ„å»º

```
touch oeasy.txt
ls oeasy.txt
```

- ç”Ÿæˆæ–‡ä»¶

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/190654/uid1190679-20250723-1753281058092) 

- æ–‡ä»¶å·²ç»å­˜åœ¨

### è§‚å¯Ÿæ–‡ä»¶

```
f = open("oeasy.txt", "r")
f.read()
f.close()
```

- æ–°å»ºçš„æ–‡ä»¶ä¸ºç©º

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/190654/uid1190679-20250723-1753281187010) 

### å¼€å§‹å†™å…¥

```
f = open("oeasy.txt", "w")
f.write("oeasy")
f.close()
```

- å†™å…¥oeasy

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/190654/uid1190679-20250723-1753281217121) 

- æ€ä¹ˆè¿½åŠ å‘¢ï¼Ÿ

### è¿½åŠ å†™å…¥

- æŠŠ å†™å…¥`w`rite 
	- ä¿®æ”¹ä¸º è¿½åŠ `a`ppend

```
f = open("oeasy.txt", "a")
f.write("o2z")
f.close()
```

- å†™å…¥äº†3-bytes

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/190654/uid1190679-20250723-1753281283910) 

### å†æ¬¡è¯»å–

```
f = open("oeasy.txt", "r")
f.read()
f.close()
```

- çœ‹èµ·æ¥ç¡®å®æ˜¯ append ä¸Šå»äº†
	- åŸæ¥çš„ä¸œè¥¿ä¸ä¼š truncate

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/190654/uid1190679-20250723-1753281336227) 


- ä½†æ˜¯ä¸€ä¼šå„¿ wæˆ–a ä¸€ä¼šå„¿ r
	- åˆ‡æ¥åˆ‡å»å¥½éº»çƒ¦
- å¯ä»¥ æ—¢å†™write åˆread å—ï¼Ÿ

### æœç´¢

```
help(open)
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210826-1629975180837)

- æ„Ÿè§‰å°±æ˜¯+

### å®éªŒ

- ç»§ç»­ä¹¦å†™

```
f = open("oeasy.txt", "a+")
f.write("o3z")
f.write("o4z")
f.seek(0)
f = open("oeasy.txt", "r")
f.read()
f.close()
```

- æœ‰ç§åŠ¿å¦‚ç ´ç«¹çš„æ„Ÿè§‰
	- a+ å…¶å®å°±æ˜¯append + read

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/190654/uid1190679-20250723-1753281651634) 

- é‚£æˆ‘å¯ä»¥æŠŠ a å½“åš w æ¥ç”¨ä¹ˆï¼Ÿ

### å°è¯•
- æƒ³è¦å…ˆæ¸…ç©º
	- ç„¶åå†å†™

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210826-1629975611673)

- å¥½åƒå¤±è´¥äº†
	- ä¸ºä»€ä¹ˆå‘¢?

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220404-1649035251696)

- æŸ¥è¯¢å‡½æ•°å®šä¹‰?
	- é—®é¢˜æ˜¯æŸ¥ä»€ä¹ˆå‘¢ï¼Ÿ

### æŸ¥æ–‡æ¡£

```
help(open)
```

- openå‡½æ•°æœ‰å¸®åŠ©æ–‡æ¡£

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221231-1672448394119)

- å‘Šè¯‰æˆ‘ä»¬è¿”å›4ç§å¯¹è±¡ç±»å‹

| TextIOWrapper | BufferedReader | BufferedWriter | BufferedRandom|
| --- | --- | --- | --- |
| r/wt/rt..| rb | wb | wb+ |
| æ–‡æœ¬å°è£… | äºŒè¿›åˆ¶è¯»ç¼“å­˜ | äºŒè¿›åˆ¶å†™ç¼“å­˜ | äºŒè¿›åˆ¶è¯»å†™ç¼“å­˜|

- æˆ‘æŸ¥æŸ¥æ–‡æœ¬çš„TextIOWrapper

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220404-1649035346264)

### seekå‡½æ•°

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220404-1649035540865)

- seekçš„ä½œç”¨æ˜¯æ”¹å˜æ–‡æœ¬æµä¸­æŒ‡é’ˆçš„ä½ç½®

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210826-1629975611673)

- åˆšæ‰çš„æµç¨‹æ˜¯
	- å…ˆå†™"o5z"
	- å†æ”¹ä½ç½®å›æœ€åˆ
	- æœ€åå†è¯»

### æ¸…ç©ºä½ç½®
- æˆ‘ä»¬åº”è¯¥å…ˆæ”¹ä½ç½®ï¼Œå†å»å†™

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210826-1629975904653)

- è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é‡å¤´æ”¹å†™æ–‡æ¡£äº†
	- æ³¨æ„æ˜¯å½»åº•æ”¹å†™
	- åŸæ¥æ–‡æ¡£åé¢çš„"o2z"ä¹‹ç±»çš„éƒ½æ¶ˆå¤±äº†

### truncate

- æŸ¥è¯¢æ–‡æ¡£çœŸçš„æœ‰ç”¨
	- æˆ‘ä»¬å†æ¥æŸ¥æŸ¥truncateå‡½æ•°

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220404-1649036299115)

- truncate æœ¬æ„æ˜¯é”¯æ–­æœ¨å¤´
- è¿™é‡Œä¹Ÿå¯ä»¥é”¯æ–­æ–‡ä»¶

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220404-1649036027947)

### truncate

- truncateåœ¨æ²¡æœ‰å‚æ•°çš„æ—¶å€™å’Œtellä¸€æ ·
	- è¿”å›ç›®å‰é•¿åº¦
- æœ‰å‚æ•°çš„è¯å¯ä»¥æˆªæ–­å­—ç¬¦ä¸²

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220404-1649036091968)

- æˆªæ–­å­—ç¬¦ä¸²æ˜¯æŒ‰ç…§å‚æ•°æ¥æˆªæ–­çš„
	- f.truncate(3) ç•™3ä¸ªå­—èŠ‚
	- f.truncate(2) ç•™2ä¸ªå­—èŠ‚
 	- f.truncate(1) ç•™1ä¸ªå­—èŠ‚
	- f.truncate(0) å½»åº•æ¸…ç©º

### ç”¨aæ¥w

```
f = open("oeasy.txt", "w")
f.write("o2zo3zo4zo5z")
f.close()
```

- é‡å†™æ–‡ä»¶

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/190654/uid1190679-20250723-1753282597870) 

### è¿½åŠ è¯»å–

```
f = open("oeasy.txt", "a+")
f.read()
```

- è¿½åŠ æ¨¡å¼è¯»å–æ–‡ä»¶
	- ç”±äºæŒ‡é’ˆåœ¨æœ€å 
	- è¯»ä¸å‡ºæ¥

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/190654/uid1190679-20250723-1753282637701) 

- æƒ³è¯»å‡ºæ€ä¹ˆåŠå‘¢ï¼Ÿ

### ä»å¤´è¯»å– 

- æŠŠæ–‡æœ¬æµæŒ‡é’ˆ æ”¾åœ¨å¼€å¤´

```
f.seek(0)
f.read()
```

- å†è¯»å–

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20250723-1753282799470)

- æƒ³è¦é‡æ–°å†™æ–‡ä»¶
	- éœ€è¦æŠŠåŸæ–‡ä»¶æ¸…ç©º

### æ¸…ç©ºæ–‡ä»¶

```
f.truncate(0)
f.read()
```

- å·²ç»æŠŠæ–‡ä»¶æ¸…ç©º

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20250723-1753282884060)

### å†å†™æ–‡ä»¶

```
f.write("oeasy")
```

- å†™å®Œå†è¯»

```
f.read()
```

- å•¥ä¹Ÿè¯»ä¸å‡ºæ¥

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20250723-1753282951830)

- ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

### æ§åˆ¶æŒ‡é’ˆ

- å› ä¸º æŒ‡é’ˆä½ç½® åœ¨æœ€å

```
f.seek(0)
f.read()
f.close()
```

- æŠŠæ–‡æœ¬æµçš„æŒ‡é’ˆ åˆ‡å›åˆ° æœ€åˆçš„ä½ç½®
	- ä»å¼€å¤´è¯»å–

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/190654/uid1190679-20250723-1753283023776) 

- è¿™æ ·æˆ‘ä»¬å°±ç”¨ a å¹²äº† w çš„äº‹æƒ…
	- é‚£æˆ‘ä»¬ åè¿‡æ¥ å—ï¼Ÿ
	- èƒ½ç”¨ w å¹²a çš„äº‹æƒ…å—ï¼Ÿ

### å°è¯•

- å…ˆæŠŠå†…å®¹è¯»åˆ°s_original

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220312-1647093212131)

- wæ¸…ç©ºå
	- å…ˆå†™è¿›s_original
	- å†å†™æ–°çš„
	- è¿™ä¸å°±æ˜¯è¿½åŠ äº†ä¹ˆï¼Ÿ
- å†™å…¥(w)å’Œè¿½åŠ (a)ä¸¤ç§æ¨¡å¼å¯ä»¥ç›¸äº’è½¬åŒ–äº†
	- æ— è®ºw+è¿˜æ˜¯a+
	- è¿™ä¸ª+æ¨¡å¼åªæ˜¯è®©å†™å…¥æ¨¡å¼ä¸‹å¢åŠ äº†è¯»(read)çš„åŠŸèƒ½
- é‚£ä¹ˆäºŒè¿›åˆ¶(b)å’Œæ–‡æœ¬(t) ä¸¤ç§æ¨¡å¼å¯ä»¥è½¬åŒ–ä¹ˆï¼Ÿ

### ç”¨äºŒè¿›åˆ¶å†™æ–‡æœ¬

- å¯ä»¥å…ˆæŠŠæ–‡æœ¬è½¬åŒ–ä¸ºå­—èŠ‚
	- å†ç”¨äºŒè¿›åˆ¶çš„æ–¹å¼å†™å­—èŠ‚

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220404-1649037555426)

- æœ€å ç”¨æ–‡æœ¬çš„æ–¹å¼è¯»å‡ºæ¥
	- ä¸€ç‚¹æ¯›ç—…æ²¡æœ‰

### ç”¨æ–‡æœ¬å†™äºŒè¿›åˆ¶

- å¯ä»¥æŠŠäºŒè¿›åˆ¶å­—èŠ‚åºåˆ—æ–‡æœ¬åŒ–

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220404-1649037577870)

- ä½†æ˜¯æœ‰ç‚¹é—®é¢˜
	- æœ‰äº›äºŒè¿›åˆ¶å­—èŠ‚ å¹¶ä¸ å¯¹åº”å…·ä½“æ–‡æœ¬å­—ç¬¦
	- æ¯”å¦‚`b"\x00"`

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220404-1649037666269)

- è¿™å°±æ²¡æœ‰åŠæ³•äº†...

### æ€»ç»“

- è¿™æ¬¡æˆ‘ä»¬ç ”ç©¶è¿½åŠ æ–‡ä»¶
  - è¿½åŠ æ–‡ä»¶å°±æ˜¯æŠŠæ–‡ä»¶æ‰“å¼€
  - ç„¶ååœ¨åé¢å†™ä¸Šè¦å†™çš„å†…å®¹
- è¿˜æœ‰è¯»å†™åŠŸèƒ½+
  - è¿™å¯ä»¥è®©æˆ‘ä»¬æ—¢å¯ä»¥è¯»åˆå¯ä»¥å†™
  - w å’Œ a ä¸æ˜¯å­¤ç«‹çš„
	- è€Œä¸”æ˜¯å¯ä»¥ç›¸äº’è½¬åŒ–çš„
  - b å’Œ t ä¹Ÿä¸æ˜¯å­¤ç«‹çš„
	- ä¹Ÿæ˜¯å¯ä»¥ç›¸äº’è½¬åŒ–çš„  
- æˆ‘è¿˜æƒ³è®©ç¨‹åºå†™ç‚¹å¤æ‚çš„ç¨‹åº
  - ä»æ–‡ä»¶è¯»å–ä¿¡æ¯
  - å®Œæˆä¸ªè®¡ç®—
- å¯ä»¥ä¹ˆï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´ ğŸ‘‹
