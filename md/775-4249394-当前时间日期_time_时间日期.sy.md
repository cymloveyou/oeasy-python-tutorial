---
show: step
version: 1.0
enable_checker: true
---

# æ–‡ç”Ÿå›¾æ¨¡å‹è°ƒç”¨

## å›å¿†

- ä¸Šæ¬¡ é€šè¿‡messages
	- ç»™å¤§è¯­è¨€æ¨¡å‹ æ·»åŠ äº†èŠå¤©è®°å½•
	- è¿™æ ·å¤§è¯­è¨€æ¨¡å‹ å°±æœ‰äº† è®°å¿†
	- æˆä¸ºäº†æ™ºèƒ½ä½“(agent)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4213426/uid1190679-20250917-1758117153418)

- ä½†æ˜¯ 
	- ç›®å‰æ™ºèƒ½ä½“æ— æ³•çŸ¥é“ 
	- å½“å‰æ—¥æœŸæ—¶é—´
	- æ€ä¹ˆåŠå‘¢ï¼ŸğŸ¤”

### åŸå§‹ä»£ç 

```
from openai import OpenAI

client = OpenAI(
    base_url='https://api-inference.modelscope.cn/v1',
    api_key = 'ms-5a818c2a-7605-41bd-9183-416f78373fda'
)

response = client.chat.completions.create(
    model='Qwen/Qwen3-Next-80B-A3B-Instruct', # ModelScope Model-Id
    messages=[
        {
            'role': 'system',
            'content': 'ä½ æ˜¯æ™ºèƒ½åŠ©æ‰‹'
        },
        {
            'role': 'user',
            'content': input("æˆ‘:")
        }
    ],
    stream=True
)

for chunk in response:
    print(chunk.choices[0].delta.content, end='', flush=True)

```

- è¿è¡Œç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4218410/uid1190679-20250921-1758454972381) 

### ç›®æ ‡

- å¦‚ä½•è®©å¤§æ¨¡å‹æŸ¥è¯¢åˆ°å½“å‰æ—¶é—´ï¼Ÿ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4218410/uid1190679-20250921-1758442241005) 

### æŸ¥è¯¢æ—¶é—´


```
import time
time.asctime()
```

- å¯ä»¥åœ¨shellè¿è¡Œå‘½ä»¤
	- å¾—åˆ°æ—¥æœŸæ—¶é—´

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4218410/uid1190679-20250921-1758459482932) 

- å¯ä»¥ä¸€ä¸Šæ¥
	- å°±æŠŠ æ—¥æœŸæ—¶é—´ 
	- ä½œä¸º ä¸Šä¸‹æ–‡
	- äº¤ä»£ç»™ å¤§æ¨¡å‹

### ç³»ç»Ÿäººè®¾

- åŸæ¥æ˜¯ å°† å¤§æ¨¡å‹è®¾ç½®ä¸º çŒ«
	- ç°åœ¨æ˜¯ æŠŠç³»ç»Ÿæ—¶é—´ ç›´æ¥å‘Šè¯‰å¤§æ¨¡å‹ 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4249394/uid1190679-20250929-1759111346970) 


### äº¤ä»£æ—¶é—´æ—¥æœŸ

```
from openai import OpenAI
import time

client = OpenAI(
    base_url='https://api-inference.modelscope.cn/v1',
    api_key = 'ms-5a818c2a-7605-41bd-9183-416f78373fda'
)

response = client.chat.completions.create(
    model='Qwen/Qwen3-Next-80B-A3B-Instruct', # ModelScope Model-Id
    messages=[
        {
            'role': 'system',
            'content': 'ä½ æ˜¯æ™ºèƒ½åŠ©æ‰‹,å½“å‰æ—¶é—´æ˜¯' + time.asctime() 
        },
        {
            'role': 'user',
            'content': input("æˆ‘:")
        }
    ],
    stream=True
)

for chunk in response:
    print(chunk.choices[0].delta.content, end='', flush=True)

```

- ç¡®å®å¯ä»¥å¾—åˆ°
	1. æ—¥æœŸ
	2. æ—¶é—´

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4218410/uid1190679-20250921-1758459860130) 

- ä½†æ˜¯æ‰€æœ‰ä¸œè¥¿éƒ½ç›´æ¥å †åœ¨
	- system çš„ç¯å¢ƒä¸Šä¸‹æ–‡ä¸­
	- è¿˜æ˜¯å¤ªå¤šäº†

### æ¡ä»¶

- æ ¹æ®é—®é¢˜åˆ¤æ–­
	- å¦‚æœåŒ…å«
		1. å‡ ç‚¹
		2. ç°åœ¨
		3. å‡ å·
		4. æ˜ŸæœŸå‡ 
	- å°±è°ƒç”¨time.asctime()
		- å¹¶ä¸”ç»™åˆ°ä¸Šä¸‹æ–‡

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4249394/uid1190679-20250929-1759155737882) 

### ä»£ç 

```
from openai import OpenAI
import time

client = OpenAI(
    base_url='https://api-inference.modelscope.cn/v1',
    api_key = 'ms-5a818c2a-7605-41bd-9183-416f78373fda'
)

# è·å–ç”¨æˆ·è¾“å…¥
user_question = input('è¯·è¾“å…¥æ‚¨çš„é—®é¢˜: ')

# æ£€æµ‹æ˜¯å¦åŒ…å«æ—¶é—´ç›¸å…³å…³é”®è¯
time_keywords = ['å‡ ç‚¹', 'ç°åœ¨', 'å‡ å·', 'æ˜ŸæœŸå‡ ']
has_time_question = any(keyword in user_question for keyword in time_keywords)

# æ„å»ºç³»ç»Ÿæ¶ˆæ¯
system_content = 'You are a helpful assistant.'
if has_time_question:
    current_time = time.asctime()
    system_content += f' å½“å‰æ—¶é—´æ˜¯: {current_time}'

response = client.chat.completions.create(
    model='Qwen/Qwen3-Next-80B-A3B-Instruct', # ModelScope Model-Id
    messages=[
        {
            'role': 'system',
            'content': system_content
        },
        {
            'role': 'user',
            'content': user_question
        }
    ],
    stream=True
)

for chunk in response:
    print(chunk.choices[0].delta.content, end='', flush=True)

```

### è¿è¡Œæ•ˆæœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4218410/uid1190679-20250921-1758460426777) 

- é™¤äº†ä½¿ç”¨time.asctime()

```
date
```

- shellä¸­çš„ dateå‘½ä»¤
	- ä¹Ÿå¯ä»¥å¾—åˆ°å½“å‰æ—¶é—´ã€æ—¥æœŸ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4249394/uid1190679-20250921-1758460857942) 

- å¯ä»¥åœ¨pythoné‡Œé¢è°ƒç”¨shellå‘½ä»¤å—ï¼Ÿ

### å°è¯•è°ƒç”¨

```
import os
os.system('date')
```

- è¿è¡Œç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4249394/uid1190679-20250921-1758461063922) 

- å¯ä»¥æŠŠshellå‘½ä»¤
	- ä½œä¸ºå­è¿›ç¨‹ æ¥æ‰§è¡Œå—ï¼Ÿ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4249394/uid1190679-20250921-1758461137508) 

### å­è¿›ç¨‹æ¨¡å¼

```
import subprocess
result = subprocess.run(['date'], capture_output=True, text=True)
print(result.stdout)
```

- è¿è¡Œç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4249394/uid1190679-20250921-1758461489448) 

- å¯ä»¥ç”¨å­è¿›ç¨‹çš„æ–¹å¼
	- æ›¿æ¢åŸæ¥çš„ time.asctime() å—ï¼Ÿ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4249394/uid1190679-20250921-1758461303740) 

### æ–°æ¨¡å¼

```
from openai import OpenAI
import subprocess

client = OpenAI(
    base_url='https://api-inference.modelscope.cn/v1',
    api_key = 'ms-5a818c2a-7605-41bd-9183-416f78373fda'
)

# è·å–ç”¨æˆ·è¾“å…¥
user_question = input('è¯·è¾“å…¥æ‚¨çš„é—®é¢˜: ')

# æ£€æµ‹æ˜¯å¦åŒ…å«æ—¶é—´ç›¸å…³å…³é”®è¯
time_keywords = ['å‡ ç‚¹', 'ç°åœ¨', 'å‡ å·', 'æ˜ŸæœŸå‡ ']
has_time_question = any(keyword in user_question for keyword in time_keywords)

# æ„å»ºç³»ç»Ÿæ¶ˆæ¯
system_content = 'You are a helpful assistant.'
if has_time_question:
    try:
        # ä½¿ç”¨subprocessè°ƒç”¨ç³»ç»Ÿdateå‘½ä»¤è·å–æ—¶é—´
        result = subprocess.run(['date'], capture_output=True, text=True, timeout=5)
        if result.returncode == 0:
            current_time = result.stdout.strip()
        else:
            current_time = "æ— æ³•è·å–å½“å‰æ—¶é—´"
    except (subprocess.TimeoutExpired, subprocess.SubprocessError, FileNotFoundError):
        current_time = "æ— æ³•è·å–å½“å‰æ—¶é—´"
    system_content += f' å½“å‰æ—¶é—´æ˜¯: {current_time}'

response = client.chat.completions.create(
    model='Qwen/Qwen3-Next-80B-A3B-Instruct', # ModelScope Model-Id
    messages=[
        {
            'role': 'system',
            'content': system_content
        },
        {
            'role': 'user',
            'content': user_question
        }
    ],
    stream=True
)

for chunk in response:
    print(chunk.choices[0].delta.content, end='', flush=True)

```

- è¿è¡Œé¡ºåˆ©

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4249394/uid1190679-20250921-1758462023530) 

- ä»–ä¸ºä»€ä¹ˆä¼šè¿è¡Œé¡ºåˆ©å‘¢ï¼Ÿ

### è¾“å‡ºä¸Šä¸‹æ–‡

```
from openai import OpenAI
import subprocess
def show_messages(messages):
    print()
    counter = 1
    for message in messages:
        print("\033[4" + str(counter) + "m",end="")
        print(message,end="")
        print("\33[0m")
        counter = counter + 1
        if counter == 7:
            counter = 1

client = OpenAI(
    base_url='https://api-inference.modelscope.cn/v1',
    api_key = 'ms-5a818c2a-7605-41bd-9183-416f78373fda'
)

# è·å–ç”¨æˆ·è¾“å…¥
user_question = input('è¯·è¾“å…¥æ‚¨çš„é—®é¢˜: ')

# æ£€æµ‹æ˜¯å¦åŒ…å«æ—¶é—´ç›¸å…³å…³é”®è¯
time_keywords = ['å‡ ç‚¹', 'ç°åœ¨', 'å‡ å·', 'æ˜ŸæœŸå‡ ']
has_time_question = any(keyword in user_question for keyword in time_keywords)

# æ„å»ºç³»ç»Ÿæ¶ˆæ¯
system_content = 'You are a helpful assistant.'
if has_time_question:
    try:
        # ä½¿ç”¨subprocessè°ƒç”¨ç³»ç»Ÿdateå‘½ä»¤è·å–æ—¶é—´
        result = subprocess.run(['date'], capture_output=True, text=True, timeout=5)
        if result.returncode == 0:
            current_time = result.stdout.strip()
        else:
            current_time = "æ— æ³•è·å–å½“å‰æ—¶é—´"
    except (subprocess.TimeoutExpired, subprocess.SubprocessError, FileNotFoundError):
        current_time = "æ— æ³•è·å–å½“å‰æ—¶é—´"
    system_content += f' å½“å‰æ—¶é—´æ˜¯: {current_time}'

messages = [
        {
            'role': 'system',
            'content': system_content
        },
        {
            'role': 'user',
            'content': user_question
        }
    ]

show_messages(messages)
response = client.chat.completions.create(
    model='Qwen/Qwen3-Next-80B-A3B-Instruct', # ModelScope Model-Id
    messages=messages,
    stream=True
)

for chunk in response:
    print(chunk.choices[0].delta.content, end='', flush=True)


```

### ä¸Šä¸‹æ–‡æ•ˆæœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4249394/uid1190679-20250930-1759203503518) 

- ç”±äºç”¨æˆ·æç¤ºè¯ åŒ¹é…äº†
	- æ—¶é—´ç›¸å…³è¯
	- äºæ˜¯ å½“å‰æ—¶é—´è¢« ç¿»åˆ°äº†ç³»ç»Ÿäººè®¾ä¸­


### æ–°çš„é—®é¢˜

- æˆ‘æƒ³çŸ¥é“å½“å‰ç›®å½•

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4249394/uid1190679-20250930-1759203673834) 

```
å½“å‰å¯ä»¥ä½¿ç”¨æ—¶é—´å…³é”®è¯åŒ¹é…çš„è¯æ‰§è¡Œ date å‘½ä»¤ï¼Œä½†å¦‚æœæ˜¯æƒ³é—®å’Œç³»ç»Ÿç›®å½•ç›¸å…³çš„ï¼Œå¦‚ä½•è®©å®ƒåŒ¹é…åˆ° pwdå‘½ä»¤å‘¢ï¼Ÿ
```

### ä¿®æ”¹ä»£ç 

- åˆ¤æ–­æ˜¯å¦ç¬¦åˆç›®å½•å…³é”®è¯

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4249394/uid1190679-20250930-1759203822627) 

- å¦‚æœåŒ¹é…çš„è¯
	- è¿˜æ˜¯åŠ å…¥åˆ°ç³»ç»Ÿäººè®¾ä¸­

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4249394/uid1190679-20250930-1759203936754) 

```
from openai import OpenAI
import subprocess
def show_messages(messages):
    print()
    counter = 1
    for message in messages:
        print("\033[4" + str(counter) + "m",end="")
        print(message,end="")
        print("\33[0m")
        counter = counter + 1
        if counter == 7:
            counter = 1

client = OpenAI(
    base_url='https://api-inference.modelscope.cn/v1',
    api_key = 'ms-5a818c2a-7605-41bd-9183-416f78373fda'
)

# è·å–ç”¨æˆ·è¾“å…¥
user_question = input('è¯·è¾“å…¥æ‚¨çš„é—®é¢˜: ')

# æ£€æµ‹æ˜¯å¦åŒ…å«æ—¶é—´ç›¸å…³å…³é”®è¯
time_keywords = ['å‡ ç‚¹', 'ç°åœ¨', 'å‡ å·', 'æ˜ŸæœŸå‡ ']
has_time_question = any(keyword in user_question for keyword in time_keywords)

# æ£€æµ‹æ˜¯å¦åŒ…å«ç›®å½•ç›¸å…³å…³é”®è¯
dir_keywords = ['ç›®å½•', 'è·¯å¾„', 'å½“å‰ç›®å½•', 'pwd']
has_dir_question = any(keyword in user_question for keyword in dir_keywords)

# æ„å»ºç³»ç»Ÿæ¶ˆæ¯
system_content = 'You are a helpful assistant.'
if has_time_question:
    try:
        # ä½¿ç”¨subprocessè°ƒç”¨ç³»ç»Ÿdateå‘½ä»¤è·å–æ—¶é—´
        result = subprocess.run(['date'], capture_output=True, text=True, timeout=5)
        if result.returncode == 0:
            current_time = result.stdout.strip()
        else:
            current_time = "æ— æ³•è·å–å½“å‰æ—¶é—´"
    except (subprocess.TimeoutExpired, subprocess.SubprocessError, FileNotFoundError):
        current_time = "æ— æ³•è·å–å½“å‰æ—¶é—´"
    system_content += f' å½“å‰æ—¶é—´æ˜¯: {current_time}'

if has_dir_question:
    try:
        # ä½¿ç”¨subprocessè°ƒç”¨ç³»ç»Ÿpwdå‘½ä»¤è·å–å½“å‰ç›®å½•
        result = subprocess.run(['pwd'], capture_output=True, text=True, timeout=5)
        if result.returncode == 0:
            current_dir = result.stdout.strip()
        else:
            current_dir = "æ— æ³•è·å–å½“å‰ç›®å½•"
    except (subprocess.TimeoutExpired, subprocess.SubprocessError, FileNotFoundError):
        current_dir = "æ— æ³•è·å–å½“å‰ç›®å½•"
    system_content += f' å½“å‰ç›®å½•æ˜¯: {current_dir}'

messages = [
        {
            'role': 'system',
            'content': system_content
        },
        {
            'role': 'user',
            'content': user_question
        }
    ]

show_messages(messages)
response = client.chat.completions.create(
    model='Qwen/Qwen3-Next-80B-A3B-Instruct', # ModelScope Model-Id
    messages=messages,
    stream=True
)

# å¤„ç†å“åº”
try:
    # å°è¯•å¤„ç†æµå¼å“åº”
    for chunk in response:
        if hasattr(chunk, 'choices') and chunk.choices and hasattr(chunk.choices[0], 'delta') and hasattr(chunk.choices[0].delta, 'content') and chunk.choices[0].delta.content:
            print(chunk.choices[0].delta.content, end='', flush=True)
except AttributeError:
    # å¦‚æœresponseä¸æ˜¯é¢„æœŸçš„æ ¼å¼ï¼Œå°è¯•ç›´æ¥å¤„ç†éæµå¼å“åº”
    try:
        # å°è¯•ä½œä¸ºéæµå¼å“åº”å¤„ç†
        if hasattr(response, 'choices') and response.choices:
            print(response.choices[0].message.content)
        else:
            print("è·å–å“åº”æ—¶å‡ºç°æ ¼å¼é—®é¢˜ï¼š")
            print(response)
    except Exception as e:
        print(f"å¤„ç†å“åº”æ—¶å‘ç”Ÿé”™è¯¯ï¼š{e}")


```

### ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4249394/uid1190679-20250930-1759203992487) 

- å¦‚æœä¸¤ä¸ªæ¨¡å¼ éƒ½åŒ¹é…

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4249394/uid1190679-20250930-1759204048188) 

- ä½†æ˜¯ è¿™æ˜¯
	- ä¸€ä¸ªä¸ªåœ° å¾€ç³»ç»Ÿäººè®¾ä¸Šé¢å åŠ å†…å®¹å•Š
	- èƒ½å¦å……åˆ†åˆ©ç”¨å¤§æ¨¡å‹çš„ æ¨ç†èƒ½åŠ›å‘¢ï¼Ÿ

### æ€»ç»“

- è¿™æ¬¡ æˆ‘ä»¬è®©æ™ºèƒ½ä½“
	- çŸ¥é“ æ—¥æœŸå’Œæ—¶é—´
	- ç”šè‡³ ä½¿ç”¨èµ· ç»ˆç«¯å·¥å…·

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4249394/uid1190679-20250921-1758463156127) 

- å¦‚ä½•è®© æ™ºèƒ½ä½“ 
	- æ›´å¥½åœ°ä½¿ç”¨ ç»ˆç«¯å·¥å…· å‘¢ï¼Ÿ 
- ä¸‹æ¬¡å†è¯´ğŸ‘‹