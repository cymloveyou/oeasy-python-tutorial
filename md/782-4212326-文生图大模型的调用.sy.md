---
show: step
version: 1.0
enable_checker: true
---

# æ–‡ç”Ÿå›¾æ¨¡å‹è°ƒç”¨

## å‡†å¤‡å·¥ä½œ

```
firefox http://modelscope.cn
```

- é¦–å…ˆè¦æ³¨å†Œé­”æ­ç¤¾åŒº

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4212326/uid1190679-20250916-1757992179107) 

- æ³¨æ„é­”æ­ç¤¾åŒºè¦ä½¿ç”¨é˜¿é‡Œäº‘ä¸Šçš„èµ„æº
	- éœ€è¦æˆæƒ

### é€‰æ‹©æ¨¡å‹

- ç‚¹å‡» æ¨¡å‹åº“
	- æ–‡ç”Ÿå›¾
	- ç­›é€‰ æ”¯æŒä½“éªŒ 
		- `API-inference`


![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4212326/uid1190679-20250916-1757992377938) 

- å•è¯è§£é‡Š
> API
	>> Application Programming Interface
		>>> åº”ç”¨ç¨‹åºæ¥å£

> inference
	>> æ¨ç†
	>>> å¯ä»¥ç›´æ¥åœ¨æœåŠ¡å™¨ `äº‘ç«¯æ¨ç†`

### åœ¨çº¿å®è·µ

- è¿›å…¥æ¨¡å‹é¡µé¢å
	- ä½“éªŒ åœ¨çº¿æ¨ç†

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4212326/uid1190679-20250916-1757993455681) 

### è¾“å…¥å…³é”®è¯

```
ä¸€ä¸ªå°ä¸‘åœ¨åŒ—æµ·å…¬å›­çš„ç™½å¡”ä¸‹é¢åƒé¢æ¡
```

- è¾“å…¥å…³é”®è¯

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4212326/uid1190679-20250916-1757993579845) 

- å¦‚ä½•ç¼–ç¨‹å®ç°å‘¢ï¼Ÿ

### æ‰¾åˆ°ä»£ç 

- é­”æ­ç¤¾åŒº æ ¹æ®ä½ çš„ç™»å½•çŠ¶æ€
	- ä¼šæ‰¾åˆ°ä½ çš„api-key

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4212326/uid1190679-20250916-1757993687578) 

- ç„¶åç”Ÿæˆä»£ç 

### å‡†å¤‡è¿è¡Œ

```
cd Code
vi txt2img.py
```

- è¿è¡Œæ–‡ç”Ÿå›¾ä»£ç 
	- å¦‚æœåœ¨è“æ¡¥è¿è¡Œ éœ€è¦æœ‰ç½‘ç»œ
	- å¯èƒ½éœ€è¦ä¼šå‘˜æƒé™

```
import requests
import time
import json
from PIL import Image
from io import BytesIO

base_url = 'https://api-inference.modelscope.cn/'
api_key = "ms-81c1f87a-fa0a-4edc-a4a5-4bc7ba3cbbbaa" # ModelScope Token

common_headers = {
    "Authorization": f"Bearer {api_key}",
    "Content-Type": "application/json",
}

response = requests.post(
    f"{base_url}v1/images/generations",
    headers={**common_headers, "X-ModelScope-Async-Mode": "true"},
    data=json.dumps({
        "model": "Qwen/Qwen-Image", # ModelScope Model-Id, required
        "prompt": "A golden cat"
    }, ensure_ascii=False).encode('utf-8')
)

response.raise_for_status()
task_id = response.json()["task_id"]

while True:
    result = requests.get(
        f"{base_url}v1/tasks/{task_id}",
        headers={**common_headers, "X-ModelScope-Task-Type": "image_generation"},
    )
    result.raise_for_status()
    data = result.json()

    if data["task_status"] == "SUCCEED":
        image = Image.open(BytesIO(requests.get(data["output_images"][0]).content))
        image.save("result_image.jpg")
        break
    elif data["task_status"] == "FAILED":
        print("Image Generation Failed.")
        break

    time.sleep(5)
```

### è¿è¡Œç»“æœ

- å¦‚æœæŠ¥401é”™è¯¯çš„è¯ 
	- éœ€è¦ç¡®è®¤æ˜¯å¦é˜¿é‡Œäº‘å·²ç»æˆæƒ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4212326/uid1190679-20250916-1757993999863) 

- ä¸ºä»€ä¹ˆä¼šæ˜¯ä¸€åªçŒ«å‘¢ï¼Ÿ

### è§‚å¯Ÿä»£ç 

- ä¿®æ”¹ç¬¬20è¡Œä»£ç 
	- æŠŠ é‡‘çŒ« ä¿®æ”¹ä¸º é‡‘çŒ«åƒé±¼

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4212326/uid1190679-20250916-1757994104595) 

- è¿™ä¸‹åƒä¸Šé±¼å•¦

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4212326/uid1190679-20250916-1757994179775) 

- ç»ˆç«¯é‡Œé¢æ²¡æœ‰ä»»ä½•æç¤ºå•Š

### è§‚å¯Ÿä»£ç 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4212326/uid1190679-20250916-1757996368833) 

- å¹²è„†å°±è¾“å‡ºè¿™ä¸ªä»»åŠ¡id

### ä¿®æ”¹ä»£ç 

```
print("task_id-------", task_id)
```

- è¾“å‡ºä»»åŠ¡id

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4212326/uid1190679-20250916-1757996575006) 

- ä½†æ˜¯å›¾ç‰‡æ¯æ¬¡ç”Ÿæˆéƒ½ä¼šè‡ªæˆ‘è¦†ç›–

### ä¿®æ”¹å‘½å

- è¾“å‡ºæ–‡ä»¶åå–å†³äºä»»åŠ¡idäº†

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4212326/uid1190679-20250916-1757996811931) 

- ä½†æ˜¯å‘½åæ— è§„å¾‹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4212326/uid1190679-20250916-1757996848713) 

### å‘½åè§„å¾‹

- é¦–å…ˆå®šä¹‰ æç¤ºè¯(prompt)
	- ç„¶å åœ¨åå°è¾“å‡º æ—¶é—´ å’Œ æç¤ºè¯
	- å°† æ—¶é—´å’Œæç¤ºè¯ è¾“å‡ºåˆ° æ–‡ä»¶åä¸­

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4212326/uid1190679-20250916-1757997215105) 

### æ•ˆæœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4212326/uid1190679-20250916-1757997282497) 

### æ€»ç»“

- è¿™æ¬¡ä½¿ç”¨ é­”æ­ç¤¾åŒºçš„api	
	- æ„å»ºäº† æ–‡ç”Ÿå›¾çš„åº”ç”¨
	- æ–‡ç”Ÿå›¾ è¿˜èƒ½æ€ä¹ˆç©å‘¢ï¼ŸğŸ¤”

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/3584/labs/4212326/uid1190679-20250916-1757997365324) 

- ä¸‹æ¬¡å†è¯´ğŸ‘‹